<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Вход и Регистрация</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.9/css/unicons.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/0.css" />
    <style>
      /* Убедитесь, что форма корректно отображается на мобильных устройствах */
      .card-3d-wrap {
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
      }

      .card-front, .card-back {
        display: none;
        border-radius: 20px;
      }

      .checkbox:checked + label + .card-3d-wrap .card-back {
        display: block;
      }

      .checkbox:not(:checked) + label + .card-3d-wrap .card-front {
        display: block;
      }

      .logo-container {
        text-align: center;
        margin-bottom: 10px;
      }

      .logo {
        width: 400px;
        height: 125px;
        margin-bottom: -13px;
      }

      @media (max-width: 768px) {
        .card-3d-wrap {
          padding: 20px;
        }
      }

      body {
        background-color: #aa7efc;
        color: #333;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        position: relative;
      }

      .theme-toggle-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: transparent;
        border: none;
        font-size: 24px;
        cursor: pointer;
        z-index: 1000;
      }

      body {
        background-color: #aa7efc;
        color: #333;
      }

      .dark-theme {
        background-color: hsl(277, 42%, 6%);
        color: #ffffff;
      }

      .dark-theme .theme-toggle-btn {
        color: #ffffff;
      }

      .dark-theme .card-front,
      .dark-theme .card-back {
        background-color: #2b0442;
        background-image: url("/img/pattern_japanese-pattern-2_1_2_0-0_0_1__ffffff00_000000.png");
        border: #8f8e8e solid 1px;
        border-radius: 2cqh;
        position: absolute;
        -webkit-transform-style: preserve-3d;
      }

      .light-theme .card-front {
        background-color: #b98deb;
      }

      .light-theme .card-back {
        background-color:#b98deb;
      }

      .light-theme .form-style {
        color: #333;
        background-color: #f7f4fa;
        border: 1px solid #ccc;
      }

      .light-theme .btn {
        background-color: #007bff;
        color: #fff;
      }

      .light-theme .form-style {
        padding: 13px 20px;
        padding-left: 55px;
        height: 48px;
        width: 100%;
        font-weight: 500;
        border-radius: 5px;
        font-size: 22px;
        line-height: 22px;
        letter-spacing: 0.5px;
        outline: none;
        color: #7600fd;
        background-color: #faf9fc;
        border: none;
        -webkit-transition: all 200ms linear;
        transition: all 200ms linear;
        box-shadow: 0 4px 8px 0 rgba(21, 21, 21, 0.2);
      }

      /* Стили для языковых кнопок */
      .language-btns {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
      }

      .language-btns button {
        background-color: transparent;
        border: 1px solid #fff;
        color: #fff;
        padding: 8px 16px;
        margin: 5px;
        font-size: 14px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div class="section">
      <div class="container" id="login-container">
        <div class="row full-height justify-content-center">
          <div class="col-12 text-center align-self-center py-5">
            <div class="logo-container mb-4">
              <img src="../foto/logo.svg" alt="Логотип" class="logo" />
            </div>

            <div class="section pb-5 pt-5 pt-sm-2 text-center">
              <input class="checkbox" type="checkbox" id="reg-log" name="reg-log" />
              <label for="reg-log"></label>
              <div class="card-3d-wrap mx-auto">
                <div class="card-3d-wrapper">
                  <!-- Форма входа -->
                  <div class="card-front" id="login-form-container">
                    <div class="center-wrap">
                      <div class="section text-center">
                        <h4 class="mb-4 pb-3" id="login-title">Войти</h4>
                        <form id="login-form" onsubmit="handleLogin(event)">
                          <div class="form-group">
                            <input
                              type="email"
                              id="email-login"
                              class="form-style"
                              placeholder="aliya.@email.com"
                              required
                            />
                            <i class="input-icon uil uil-at"></i>
                          </div>
                          <div class="form-group mt-2">
                            <input
                              type="password"
                              class="form-style"
                              placeholder="Пароль"
                              id="password-login"
                              required
                              autocomplete="current-password"
                            />
                            <i class="input-icon uil uil-lock-alt"></i>
                          </div>
                          <button type="submit" class="btn mt-4" id="login-btn">Войти</button>
                        </form>
                        <p class="mb-0 mt-4 text-center">
                          <a href="https://wa.me/77000291005?/+7028748681?text=Здраствуйте,%20Я%20забыл(а)%20%20пароль%20." class="link" target="_blank" id="forgot-password-link">Забыли пароль?</a>
                        </p>
                        <div class="error" id="login-error"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Форма регистрации -->
                  <div class="card-back" id="registration-form-container">
                    <form id="registration-form" onsubmit="handleRegistration(event)">
                      <div class="center-wrap">
                        <div class="section text-center">
                          <h4 class="mb-3 pb-3" id="registration-title">Зарегистрироваться</h4>
                          <div class="form-group">
                            <input
                              type="text"
                              class="form-style"
                              placeholder="Имя"
                              id="name"
                              required
                            />
                            <i class="input-icon uil uil-user"></i>
                          </div>
                          <div class="form-group mt-2">
                            <input
                              type="tel"
                              class="form-style"
                              placeholder="+7-777-777-77-77"
                              id="telNo"
                              required
                            />
                            <i class="input-icon uil uil-phone"></i>
                          </div>
                          <div class="form-group mt-2">
                            <input
                              type="email"
                              class="form-style"
                              placeholder="aliya.@email.com"
                              id="email-register"
                              required
                            />
                            <i class="input-icon uil uil-at"></i>
                          </div>
                          <div class="form-group mt-2">
                            <input
                              type="password"
                              class="form-style"
                              placeholder="Пароль"
                              id="password-register"
                              required
                              autocomplete="new-password"
                            />
                            <i class="input-icon uil uil-lock-alt"></i>
                          </div>
                          <button type="submit" class="btn mt-4" id="registration-btn">Зарегистрироваться</button>
                          <div class="error" id="registration-error"></div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // Import Firebase
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js';
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js';
      import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js';
    
      // Firebase configuration
      const firebaseConfig = {
        apiKey: 'AIzaSyD0TgKtAewLx-ayBMo_iOS9ACmSvoNiT48',
        authDomain: 'world-of-quizizz.firebaseapp.com',
        databaseURL: 'https://world-of-quizizz-default-rtdb.europe-west1.firebasedatabase.app',
        projectId: 'world-of-quizizz',
        storageBucket: 'world-of-quizizz.appspot.com',
        messagingSenderId: '10687553049',
        appId: '1:10687553049:web:564aff0b7970235501d488',
        measurementId: 'G-EWLBY2QDNQ',
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
    
      // Function to save user data to Firestore
      async function saveUserToFirestore(user) {
        try {
          await setDoc(doc(db, 'users', user.uid), {
            name: document.getElementById('name').value,
            telNo: document.getElementById('telNo').value,
            email: user.email,
          });
          console.log('User data successfully saved to Firestore.');
        } catch (error) {
          console.error('Error saving to Firestore:', error);
        }
      }
    
      // Registration user
      document.getElementById('registration-form').addEventListener('submit', async (event) => {
        event.preventDefault();
    
        const email = document.getElementById('email-register').value;
        const password = document.getElementById('password-register').value;
    
        try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;
          console.log('User registered:', user);
    
          // Save user data to Firestore
          await saveUserToFirestore(user);
          alert('Registration successful!');
    
          // Redirect to open.html
          window.location.href = 'open.html';
        } catch (error) {
          console.error('Registration error:', error);
          document.getElementById('registration-error').innerText = error.message;
        }
      });
    
      // Login user
      document.getElementById('login-form').addEventListener('submit', async (event) => {
        event.preventDefault();
    
        const email = document.getElementById('email-login').value;
        const password = document.getElementById('password-login').value;
    
        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;
          console.log('User logged in:', user);
    
          // Redirect to main page
          window.location.href = 'glava.html';
        } catch (error) {
          console.error('Login error:', error);
          document.getElementById('login-error').innerText = error.message;
        }
      });
    </script>
    
  </body>
</html>